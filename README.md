# Домашнее задание к занятию «Репликация и масштабирование. Часть 2» - Кузнецов Евгений Александрович

### Задание 1

Опишите основные преимущества использования масштабирования методами:

- активный master-сервер и пассивный репликационный slave-сервер; 
- master-сервер и несколько slave-серверов;


*Дайте ответ в свободной форме.*

### Решение 1

Активный master-сервер и пассивный репликационный slave-сервер:  
- если master падает, slave может быть быстро переведён в активный режим
- только один master, проще контролировать целостность данных.
- пассивный slave всегда актуален, поэтому переключение происходит без потери данных (если репликация синхронная)
- так как записи идут только на master, нет ситуации «кто кого перепишет».
- на slave можно выполнять бэкапы без влияния на производительность master.

master-сервер и несколько slave-серверов:  
- запросы на чтение можно распределять между slave, повышая общую производительность системы.
- если master падает, один из slave можно поднять как новый master
- при выходе из строя одного slave остальные продолжают работать.
- легкое добавление новых слейвов по мере роста нагрузки без изменения архитектуры master.

### Задание 2


Разработайте план для выполнения горизонтального и вертикального шаринга базы данных. База данных состоит из трёх таблиц: 

- пользователи, 
- книги, 
- магазины (столбцы произвольно). 

Опишите принципы построения системы и их разграничение или разбивку между базами данных.

*Пришлите блоксхему, где и что будет располагаться. Опишите, в каких режимах будут работать сервера.* 

### Решение 2

Разделим БД по таблицам на разные серверы:

| Таблица      | Сервер |
| ------------ | ------ |
| пользователи | DB1    |
| книги        | DB2    |
| магазины     | DB3    |

каждый сервер отвечает за конкретную функциональность.

Разделение одной таблицы на части (шарды) по ключу:
Таблица пользователи - по user_id
Таблица книги - по book_id
Таблица магазины - по store_id

Каждая таблица разделена на Shard0, Shard1 (можно больше, если данных много):
Users Shard0 — пользователи 1–10000
Users Shard1 — пользователи 10001–20000
Books Shard0 - книги 1-5000
Books Shard1 - книги 5001-10000
Stores Shard0 - магазины 1-100
Stores Shard1 - магазины 101-200

Репликация для master-серверов:
| Сервер     | Режим                              |
| ---------- | ---------------------------------- |
| DB1-master | Read/Write (users, shard 0)        |
| DB1-slave  | Read-Only  (users, shard 0)        |
| DB2-master | Read/Write (books, shard 0)        |
| DB2-slave  | Read-Only  (books, shard 0)        |
| DB3-master | Read/Write (stores, shard 0)       |
| DB3-slave  | Read-Only  (stores, shard 0)       |


Блок схема:

                        +----------------------+
                        |      Приложение      |
                        +----------+-----------+
                                   |
            ------------------------------------------------
            |                       |                      |
            v                       v                      v
   +----------------+       +----------------+       +----------------+
   |  DB1 Master    |       |  DB2 Master    |       |  DB3 Master    |
   | (Users Table)  |       | (Books Table)  |       | Stores Table)  |
   |  Users Shard0  |       |  Books Shard0  |       | Stores Shard0  |
   |  Users Shard1  |       |  Books Shard1  |       | Stores Shard1  |
   +----------------+       +----------------+       +----------------+
            |                       |                      |
            v                       v                      v
   +----------------+       +----------------+       +----------------+
   |  DB1 Slave     |       |  DB2 Slave     |       |  DB3 Slave     |
   |  Users Shard0  |       |  Books Shard0  |       | Stores Shard0  |
   |  Users Shard1  |       |  Books Shard1  |       | Stores Shard1  |
   +----------------+       +----------------+       +----------------+